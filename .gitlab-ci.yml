image: python:3.7-stretch

cache:
  paths:
    - .cache/pip
    - venv/

before_script:
  - uname -a
  - python -V
  - apt update -q
  - apt install -qy sqlite3 libmariadbclient-dev
  - pip install virtualenv
  - virtualenv -p python3 venv
  - source venv/bin/activate
  - pip install -r api_server/requirements.txt

stages:
  - test

python_check_for_vuln_deps:
  stage: test
  script:
  - cd api_server/
  - pip install safety
  - safety check -r requirements.txt
  - safety check

python_unit_test:
  stage: test
  script:
  - cd api_server/
  - pytest test/unit -vv

python_integration_test:
  stage: test
  script:
  - cd api_server/
  - pytest test/integration -vv
