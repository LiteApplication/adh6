<div class="box">
  <div class="columns">
    <div class="column">
      <input #searchBox id="search-box" (keyup)="search(searchBox.value)" placeholder="Rechercher..."
        class="input is-fullwidth" type="text" />
    </div>
    <div class="column is-narrow">
      <select class="input" (change)="updateTypeFilter($event.target.value)">
        <option value="">-- Tout type --</option>
        <option *ngFor="let pm of paymentMethods" value="{{pm.id}}">{{pm.name}}</option>
      </select>
    </div>
  </div>
  <ng-container *ngIf="maxItems$ | async as maxItems; else noTransaction">
    <table class="table is-striped is-fullwidth" *ngIf="result$ | async as result">
      <thead>
        <tr>
          <th>Date</th>
          <th>Montant</th>
          <th>Intitulé</th>
          <th *ngIf="!asAccount">De</th>
          <th *ngIf="asAccount">De / Vers</th>
          <th *ngIf="!asAccount">Vers</th>
          <th>Moyen</th>
          <th *ngIf="actions">Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let transactionResult of result" [ngClass]="{
          'has-text-primary-dark' : asAccount && transactionResult.dst.id==this.asAccount, 
          'has-text-danger-dark' : asAccount && transactionResult.dst.id!=this.asAccount,
          'has-background-grey-lighter': transactionResult.pendingValidation
        }">
          <td class="text-center align-middle" tooltip="{{ transactionResult.timestamp | date:'dd/MM/yyy HH:mm' }}">
            <fa-icon *ngIf="transactionResult.pendingValidation" [icon]="faClock"></fa-icon>
            <h6 class="mb-0">{{ transactionResult.timestamp | date:"dd/MM" }}</h6>
            <small>{{ transactionResult.timestamp | date:"yyy" }}</small>
          </td>
          <td class="text-right text-nowrap align-middle">
            <h5>{{ (asAccount ? ( transactionResult.dst.id==asAccount ? '+' : '-' ) : '') }}{{ transactionResult.value |
              number:'':'fr' }} €
            </h5>
          </td>
          <td class="align-middle">{{ transactionResult.name }}</td>
          <td class="align-middle">{{ ( transactionResult.src.id==asAccount ? transactionResult.dst.name :
            transactionResult.src.name ) }}</td>
          <td class="align-middle" *ngIf="!asAccount">{{ transactionResult.dst.name }}</td>
          <td class="align-middle" tooltip="{{ transactionResult.author?.username }}">{{
            transactionResult.paymentMethod.name }}</td>
          <td *ngIf="actions" class="text-right align-middle">
            <div class="btn-group" role="group" aria-label="actions">
              <div class="field is-grouped">
                <p *ngFor="let action of actions" class="control">
                  <button type="button" class="button {{ action.class }}"
                    (click)="onAction.emit({name: action.name, transaction: transactionResult})"
                    *ngIf="action.condition(transactionResult)" placement="bottom" tooltip="{{action.name}}">
                    <span>
                      <fa-icon *ngIf="action.buttonIcon" [icon]="action.buttonIcon"></fa-icon>
                    </span>
                  </button>
                </p>
              </div>
            </div>
          </td>
        </tr>
      </tbody>
    </table>
    <app-pagination [maxItems]="maxItems" (pageChange)="handlePageChange($event)"></app-pagination>
  </ng-container>
  <ng-template #noTransaction>
    <h4 class="title is-4">Aucune transaction</h4>
  </ng-template>
</div>
