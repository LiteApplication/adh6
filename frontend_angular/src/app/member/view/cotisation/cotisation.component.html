<div class="notification">
  <p>Dans le cas d'une cotisation ou d'une recotisation, une validation manuelle est nécessaire.</p>
</div>
<div class="notification is-danger is-light" *ngIf="membership.status === 'PENDING_RULES'">
  <p>
    La charte n'est pas signée: <a href="//chartes.minet.net" target="_blank" rel="noopener">aller sur
      charte</a>
  </p>
</div>
<button class="button is-success is-fullwidth" (click)="validatePayment()"
  *ngIf="membership.status === 'PENDING_PAYMENT_VALIDATION'">Valider paiement</button>
<ng-template #waitingMembership>
  <button class="button is-primary is-fullwidth" disabled>Attente...</button>
</ng-template>
<form (ngSubmit)="submitSubscription()" [formGroup]="subscriptionForm">
  <div class="field">
    <label class="label">Durée de cotisation</label>
    <div class="control">
      <select (change)="updateAmount()" class="input is-fullwidth" formControlName="renewal" type="text">
        <option value="">Pas de cotisation</option>
        <option value="7">sans chambre (9€) - {{ formatDate(12) }}</option>
        <option value="1">1 mois (9€) - {{ formatDate(1) }}</option>
        <option value="2">2 mois (18€) - {{ formatDate(2) }}</option>
        <option value="3">3 mois (27€) - {{ formatDate(3) }}</option>
        <option value="4">4 mois (36€) - {{ formatDate(4) }}</option>
        <option value="5">5 mois (45€) - {{ formatDate(5) }}</option>
        <option value="6">1 an (50€) - {{ formatDate(12) }}</option>
      </select>
    </div>
  </div>
  <div class="field">
    <label class="label">Matériel à ajouter</label>
    <ng-container *ngIf="products$ | async as products">
      <div class="control" *ngFor="let product of products; let i = index" formArrayName="products">
        <div class="form-check" [formGroupName]="i">
          <label class="checkbox">
            <input formControlName="checked" (change)="updateAmount()" type="checkbox" value="">
            {{product.name}} ({{product.sellingPrice}} €)
          </label>
        </div>
      </div>
    </ng-container>
  </div>
  <div class="field">
    <label class="label">Montant : {{ amountToPay }} €</label>
    <div class="control">
      <select class="input is-fullwidth" formControlName="paidWith" type="text">
        <option value="">-- Moyen de paiement --</option>
        <option *ngFor="let pm of paymentMethods$ | async" value="{{ pm.id }}">{{ pm.name }}</option>
      </select>
    </div>
    <p *ngIf="subscriptionForm.controls['paidWith'].invalid && subscriptionForm.controls['paidWith'].touched"
      class="help is-danger">Moyen de paiement invalide
    </p>
  </div>
  <button class="button is-success is-fullwidth" type="submit" [disabled]="subscriptionForm.invalid">Valider</button>
</form>
