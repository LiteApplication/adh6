<ng-container *ngIf="(member$ | async) as member">
  <div class="tabs is-centered is-large">
    <ul>
      <li [ngClass]="{'is-active': currentTab==='profile'}">
        <a (click)="currentTab='profile'">Profile</a>
      </li>
      <li [ngClass]="{'is-active': currentTab==='payment'}">
        <a (click)="currentTab='payment'">Paiement</a>
      </li>
      <li [ngClass]="{'is-active': currentTab==='device'}">
        <a (click)="currentTab='device'">Appareils</a>
      </li>
    </ul>
  </div>
  <ng-container *ngIf="member.membership === 'PENDING_PAYMENT_VALIDATION'">
    <div class="notification is-info is-light">
      <p>Cotisation en attente de validation</p>
    </div>
  </ng-container>
  <ng-container *ngIf="currentTab==='profile'">
    <h3 class="title is-3 has-text-centered">
      <span>{{ member.firstName | lowercase | titlecase }}</span> {{member.lastName | uppercase }}
    </h3>
    <table class="table is-fullwidth">
      <tbody>
        <tr>
          <td>Login</td>
          <td>{{ member.username }}</td>
        </tr>
        <tr>
          <td>Date de départ</td>
          <td>{{ member.departureDate | date:'dd/MM/y' }}</td>
        </tr>
        <tr>
          <td>Wifi</td>
          <td *ngIf="member.subnet !== undefined && member.ip !== undefined; else noIpBlock">{{ member.subnet }} - {{
            member.ip }}</td>
          <ng-template #noIpBlock>
            <td>-</td>
          </ng-template>
        </tr>
        <tr>
          <td>Chambre</td>
          <td>
            <ng-container *ngIf="room$ | async as room; else elseNoRoom">
              <a [routerLink]='["/room/view/", room.id]'>
                {{ room.roomNumber }}
              </a>
            </ng-container>
            <ng-template #elseNoRoom>
              <button class="button is-warning" (click)="collapseMoveIn()"
                [disabled]="member.membership !== 'ABORTED' && member.membership !== 'CANCELLED' && member.membership !== 'COMPLETE'">
                Emmenager
              </button>
            </ng-template>
          </td>
        </tr>
      </tbody>
    </table>
    <div *ngIf="moveIn">
      <form (ngSubmit)="submitRoom()" [formGroup]="moveInForm">
        <input class="input is-fullwidth" formControlName="roomNumber" type="number"
          placeholder="Numéro de chambre..." />
        <button class="button is-success is-fullwidth" type="submit" [disabled]="moveInDisabled">Valider</button>
      </form>
    </div>
    <h3 class="title is-4">
      Edition
    </h3>
    <hr />
    <div class="columns">
      <div class="column">
        <a [routerLink]="['/member/edit/', member.id ]">
          <button class="button is-primary is-fullwidth">Éditer le profil</button>
        </a>
      </div>
      <div class="column">
        <a [routerLink]="['/password', member.id ]">
          <button class="button is-danger is-fullwidth">Changer mot de passe</button>
        </a>
      </div>
    </div>
    <app-mailinglist [mailinglistValue]="member.mailinglist" [memberId]="member.id"></app-mailinglist>
  </ng-container>
  <ng-container *ngIf="currentTab==='payment'">
    <app-buy [member]="member" (updateSubscription)="refreshInfo()"></app-buy>
  </ng-container>
  <ng-container *ngIf="currentTab==='device'">
    <app-auto-troubleshoot [member]="member"></app-auto-troubleshoot>
    <div class="columns">
      <div class="column">
        <h4 class="title is-4">Filaire</h4>
        <app-member-device-list #wiredList [abstractDeviceFilter]="{member: member.id, connectionType: 'wired'}"
          [macHighlighted]="macHighlighted$"></app-member-device-list>
      </div>
      <div class="column">
        <h4 class="title is-4">Wifi</h4>
        <app-member-device-list #wirelessList [abstractDeviceFilter]="{member: member.id, connectionType: 'wireless'}"
          [macHighlighted]="macHighlighted$"></app-member-device-list>
      </div>
    </div>
    <app-device-new [member_id]="member.id"
      (added)="$event.connectionType === 'wired' ? wiredList.updateSearch(): wirelessList.updateSearch()">
    </app-device-new>
    <br />
    <nav class="level">
      <div class="level-right">
        <div class="level-item has-text-centered">
          <h3 class="title is-3">Journal</h3>
        </div>
      </div>
      <div class="level-left">
        <div class="level-item has-text-centered">
          <button (click)="showLogs = !showLogs" class="button"
            [ngClass]="{'is-warning': !showLogs, 'is-danger': showLogs}" title="Afficher/Masquer le journal">
            {{showLogs ? "Cacher" : "Afficher"}}
          </button>
        </div>
      </div>
    </nav>
    <ng-container *ngIf="showLogs; else logHide">
      <nav class="level">
        <div class="level-right">
          <div class="level-item has-text-centered">
            <label class="checkbox">
              <input (change)="getDhcp = !getDhcp" type="checkbox">
              Logs DHCP
            </label>
          </div>
        </div>
        <div class="level-left">
          <div class="level-item has-text-centered">
            <button (click)="refreshLog()" class="button is-primary" title="Actualiser le journal">&#x27F3;</button>
          </div>
        </div>
      </nav>
      <div style="overflow:auto; max-height: 30em; font-family: 'Lucida Console', Monaco, monospace; font-size: small;">
        <ul class="list-unstyled is-fullwidth">
          <li *ngFor="let log of log$ | async">
            <span [innerHtml]="extractMsgFromLog(log)"></span>
          </li>
        </ul>
      </div>
    </ng-container>
  </ng-container>
</ng-container>
<ng-template #logHide>
  <div class="notification has-text-centered is-info is-light">
    <h6 class="title is-6">Logs masqués</h6>
  </div>
</ng-template>
